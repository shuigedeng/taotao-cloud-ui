"use strict";var e=require("node:fs"),t=require("node:path"),r=require("eslint"),n=require("prettier"),o=require("node:process"),s=require("node:os"),i=require("node:tty");function l(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function c(e){return Array.isArray(e)?e:[e]}const a=/^\s+$/,u=/(?:[^\\]|^)\\$/,g=/^\\!/,f=/^\\#/,h=/\r?\n/g,d=/^\.*\/|^\.+$/;let p="node-ignore";"undefined"!=typeof Symbol&&(p=Symbol.for("node-ignore"));const b=p,m=/([0-z])-([0-z])/g,v=()=>!1,y=[[/\\?\s+$/,e=>0===e.indexOf("\\")?" ":""],[/\\\s/g,()=>" "],[/[\\$.|*+(){^]/g,e=>`\\${e}`],[/(?!\\)\?/g,()=>"[^/]"],[/^\//,()=>"^"],[/\//g,()=>"\\/"],[/^\^*\\\*\\\*\\\//,()=>"^(?:.*\\/)?"],[/^(?=[^^])/,function(){return/\/(?!$)/.test(this)?"^":"(?:^|\\/)"}],[/\\\/\\\*\\\*(?=\\\/|$)/g,(e,t,r)=>t+6<r.length?"(?:\\/[^\\/]+)*":"\\/.+"],[/(^|[^\\]+)(\\\*)+(?=.+)/g,(e,t,r)=>t+r.replace(/\\\*/g,"[^\\/]*")],[/\\\\\\(?=[$.|*+(){^])/g,()=>"\\"],[/\\\\/g,()=>"\\"],[/(\\)?\[([^\]/]*?)(\\*)($|\])/g,(e,t,r,n,o)=>"\\"===t?`\\[${r}${(e=>{const{length:t}=e;return e.slice(0,t-t%2)})(n)}${o}`:"]"===o&&n.length%2==0?`[${(e=>e.replace(m,((e,t,r)=>t.charCodeAt(0)<=r.charCodeAt(0)?e:"")))(r)}${n}]`:"[]"],[/(?:[^*])$/,e=>/\/$/.test(e)?`${e}$`:`${e}(?=$|\\/$)`],[/(\^|\\\/)?\\\*$/,(e,t)=>`${t?`${t}[^/]+`:"[^/]*"}(?=$|\\/$)`]],O=Object.create(null),T=e=>"string"==typeof e;class _{constructor(e,t,r,n){this.origin=e,this.pattern=t,this.negative=r,this.regex=n}}const $=(e,t)=>{const r=e;let n=!1;0===e.indexOf("!")&&(n=!0,e=e.substr(1));const o=((e,t)=>{let r=O[e];return r||(r=y.reduce(((t,r)=>t.replace(r[0],r[1].bind(e))),e),O[e]=r),t?new RegExp(r,"i"):new RegExp(r)})(e=e.replace(g,"!").replace(f,"#"),t);return new _(r,e,n,o)},C=(e,t)=>{throw new t(e)},R=(e,t,r)=>{if(!T(e))return r(`path must be a string, but got \`${t}\``,TypeError);if(!e)return r("path must not be empty",TypeError);if(R.isNotRelative(e)){return r(`path should be a ${"`path.relative()`d"} string, but got "${t}"`,RangeError)}return!0},w=e=>d.test(e);R.isNotRelative=w,R.convert=e=>e;class j{constructor({ignorecase:e=!0,ignoreCase:t=e,allowRelativePaths:r=!1}={}){var n,o,s;n=this,o=b,s=!0,Object.defineProperty(n,o,{value:s}),this._rules=[],this._ignoreCase=t,this._allowRelativePaths=r,this._initCache()}_initCache(){this._ignoreCache=Object.create(null),this._testCache=Object.create(null)}_addPattern(e){if(e&&e[b])return this._rules=this._rules.concat(e._rules),void(this._added=!0);if((e=>e&&T(e)&&!a.test(e)&&!u.test(e)&&0!==e.indexOf("#"))(e)){const t=$(e,this._ignoreCase);this._added=!0,this._rules.push(t)}}add(e){return this._added=!1,c(T(e)?(e=>e.split(h))(e):e).forEach(this._addPattern,this),this._added&&this._initCache(),this}addPattern(e){return this.add(e)}_testOne(e,t){let r=!1,n=!1;return this._rules.forEach((o=>{const{negative:s}=o;if(n===s&&r!==n||s&&!r&&!n&&!t)return;o.regex.test(e)&&(r=!s,n=s)})),{ignored:r,unignored:n}}_test(e,t,r,n){const o=e&&R.convert(e);return R(o,e,this._allowRelativePaths?v:C),this._t(o,t,r,n)}_t(e,t,r,n){if(e in t)return t[e];if(n||(n=e.split("/")),n.pop(),!n.length)return t[e]=this._testOne(e,r);const o=this._t(n.join("/")+"/",t,r,n);return t[e]=o.ignored?o:this._testOne(e,r)}ignores(e){return this._test(e,this._ignoreCache,!1).ignored}createFilter(){return e=>!this.ignores(e)}filter(e){return c(e).filter(this.createFilter())}test(e){return this._test(e,this._testCache,!0)}}const x=e=>new j(e);x.isPathValid=e=>R(e&&R.convert(e),e,v),x.default=x;var E=x;if("undefined"!=typeof process&&(process.env&&process.env.IGNORE_TEST_WIN32||"win32"===process.platform)){const e=e=>/^\\\\\?\\/.test(e)||/["<>|\u0000-\u001F]+/u.test(e)?e:e.replace(/\\/g,"/");R.convert=e;const t=/^[a-z]:\//i;R.isNotRelative=e=>t.test(e)||w(e)}var A=l(E);const M=process.cwd(),P=A().add("node_modules"),S={entry:"/",output:"auto-import.js",resolvers:"element-ui",ignorePath:".generatorignore",logLevel:"info",check:!0};let B=S;const N=()=>B;var I={};function L(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function k(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?L(Object(r),!0).forEach((function(t){F(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):L(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function F(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Object.defineProperty(I,"__esModule",{value:!0});var G=o,Y=s,D=i;const V=(e=0)=>t=>`[${t+e}m`,q=(e=0)=>t=>`[${38+e};5;${t}m`,z=(e=0)=>(t,r,n)=>`[${38+e};2;${t};${r};${n}m`,U={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],gray:[90,39],grey:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgGray:[100,49],bgGrey:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}},W=Object.keys(U.modifier),H=Object.keys(U.color),K=Object.keys(U.bgColor),J=[...H,...K];const Q=function(){const e=new Map;for(const[t,r]of Object.entries(U)){for(const[t,n]of Object.entries(r))U[t]={open:`[${n[0]}m`,close:`[${n[1]}m`},r[t]=U[t],e.set(n[0],n[1]);Object.defineProperty(U,t,{value:r,enumerable:!1})}return Object.defineProperty(U,"codes",{value:e,enumerable:!1}),U.color.close="[39m",U.bgColor.close="[49m",U.color.ansi=V(),U.color.ansi256=q(),U.color.ansi16m=z(),U.bgColor.ansi=V(10),U.bgColor.ansi256=q(10),U.bgColor.ansi16m=z(10),Object.defineProperties(U,{rgbToAnsi256:{value:(e,t,r)=>e===t&&t===r?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(t/255*5)+Math.round(r/255*5),enumerable:!1},hexToRgb:{value(e){const t=/[a-f\d]{6}|[a-f\d]{3}/i.exec(e.toString(16));if(!t)return[0,0,0];let[r]=t;3===r.length&&(r=[...r].map((e=>e+e)).join(""));const n=Number.parseInt(r,16);return[n>>16&255,n>>8&255,255&n]},enumerable:!1},hexToAnsi256:{value:e=>U.rgbToAnsi256(...U.hexToRgb(e)),enumerable:!1},ansi256ToAnsi:{value(e){if(e<8)return 30+e;if(e<16)return e-8+90;let t,r,n;if(e>=232)t=(10*(e-232)+8)/255,r=t,n=t;else{const o=(e-=16)%36;t=Math.floor(e/36)/5,r=Math.floor(o/6)/5,n=o%6/5}const o=2*Math.max(t,r,n);if(0===o)return 30;let s=30+(Math.round(n)<<2|Math.round(r)<<1|Math.round(t));return 2===o&&(s+=60),s},enumerable:!1},rgbToAnsi:{value:(e,t,r)=>U.ansi256ToAnsi(U.rgbToAnsi256(e,t,r)),enumerable:!1},hexToAnsi:{value:e=>U.ansi256ToAnsi(U.hexToAnsi256(e)),enumerable:!1}}),U}();function X(e,t=(globalThis.Deno?globalThis.Deno.args:G.argv)){const r=e.startsWith("-")?"":1===e.length?"-":"--",n=t.indexOf(r+e),o=t.indexOf("--");return-1!==n&&(-1===o||n<o)}const{env:Z}=G;let ee;function te(e,{streamIsTTY:t,sniffFlags:r=!0}={}){const n=function(){if("FORCE_COLOR"in Z)return"true"===Z.FORCE_COLOR?1:"false"===Z.FORCE_COLOR?0:0===Z.FORCE_COLOR.length?1:Math.min(Number.parseInt(Z.FORCE_COLOR,10),3)}();void 0!==n&&(ee=n);const o=r?ee:n;if(0===o)return 0;if(r){if(X("color=16m")||X("color=full")||X("color=truecolor"))return 3;if(X("color=256"))return 2}if("TF_BUILD"in Z&&"AGENT_NAME"in Z)return 1;if(e&&!t&&void 0===o)return 0;const s=o||0;if("dumb"===Z.TERM)return s;if("win32"===G.platform){const e=Y.release().split(".");return Number(e[0])>=10&&Number(e[2])>=10586?Number(e[2])>=14931?3:2:1}if("CI"in Z)return"GITHUB_ACTIONS"in Z?3:["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","BUILDKITE","DRONE"].some((e=>e in Z))||"codeship"===Z.CI_NAME?1:s;if("TEAMCITY_VERSION"in Z)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(Z.TEAMCITY_VERSION)?1:0;if("truecolor"===Z.COLORTERM)return 3;if("xterm-kitty"===Z.TERM)return 3;if("TERM_PROGRAM"in Z){const e=Number.parseInt((Z.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(Z.TERM_PROGRAM){case"iTerm.app":return e>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(Z.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(Z.TERM)||"COLORTERM"in Z?1:s}function re(e,t={}){return function(e){return 0!==e&&{level:e,hasBasic:!0,has256:e>=2,has16m:e>=3}}(te(e,k({streamIsTTY:e&&e.isTTY},t)))}X("no-color")||X("no-colors")||X("color=false")||X("color=never")?ee=0:(X("color")||X("colors")||X("color=true")||X("color=always"))&&(ee=1);const ne={stdout:re({isTTY:D.isatty(1)}),stderr:re({isTTY:D.isatty(2)})};function oe(e,t,r){let n=e.indexOf(t);if(-1===n)return e;const o=t.length;let s=0,i="";do{i+=e.slice(s,n)+t+r,s=n+o,n=e.indexOf(t,s)}while(-1!==n);return i+=e.slice(s),i}const{stdout:se,stderr:ie}=ne,le=Symbol("GENERATOR"),ce=Symbol("STYLER"),ae=Symbol("IS_EMPTY"),ue=["ansi","ansi","ansi256","ansi16m"],ge=Object.create(null);const fe=e=>{const t=(...e)=>e.join(" ");return((e,t={})=>{if(t.level&&!(Number.isInteger(t.level)&&t.level>=0&&t.level<=3))throw new Error("The `level` option should be an integer from 0 to 3");const r=se?se.level:0;e.level=void 0===t.level?r:t.level})(t,e),Object.setPrototypeOf(t,he.prototype),t};function he(e){return fe(e)}Object.setPrototypeOf(he.prototype,Function.prototype);for(const[e,t]of Object.entries(Q))ge[e]={get(){const r=ve(this,me(t.open,t.close,this[ce]),this[ae]);return Object.defineProperty(this,e,{value:r}),r}};ge.visible={get(){const e=ve(this,this[ce],!0);return Object.defineProperty(this,"visible",{value:e}),e}};const de=(e,t,r,...n)=>"rgb"===e?"ansi16m"===t?Q[r].ansi16m(...n):"ansi256"===t?Q[r].ansi256(Q.rgbToAnsi256(...n)):Q[r].ansi(Q.rgbToAnsi(...n)):"hex"===e?de("rgb",t,r,...Q.hexToRgb(...n)):Q[r][e](...n),pe=["rgb","hex","ansi256"];for(const e of pe){ge[e]={get(){const{level:t}=this;return function(...r){const n=me(de(e,ue[t],"color",...r),Q.color.close,this[ce]);return ve(this,n,this[ae])}}};ge["bg"+e[0].toUpperCase()+e.slice(1)]={get(){const{level:t}=this;return function(...r){const n=me(de(e,ue[t],"bgColor",...r),Q.bgColor.close,this[ce]);return ve(this,n,this[ae])}}}}const be=Object.defineProperties((()=>{}),k(k({},ge),{},{level:{enumerable:!0,get(){return this[le].level},set(e){this[le].level=e}}})),me=(e,t,r)=>{let n,o;return void 0===r?(n=e,o=t):(n=r.openAll+e,o=t+r.closeAll),{open:e,close:t,openAll:n,closeAll:o,parent:r}},ve=(e,t,r)=>{const n=(...e)=>ye(n,1===e.length?""+e[0]:e.join(" "));return Object.setPrototypeOf(n,be),n[le]=e,n[ce]=t,n[ae]=r,n},ye=(e,t)=>{if(e.level<=0||!t)return e[ae]?"":t;let r=e[ce];if(void 0===r)return t;const{openAll:n,closeAll:o}=r;if(t.includes(""))for(;void 0!==r;)t=oe(t,r.close,r.open),r=r.parent;const s=t.indexOf("\n");return-1!==s&&(t=function(e,t,r,n){let o=0,s="";do{const i="\r"===e[n-1];s+=e.slice(o,i?n-1:n)+t+(i?"\r\n":"\n")+r,o=n+1,n=e.indexOf("\n",o)}while(-1!==n);return s+=e.slice(o),s}(t,o,n,s)),n+t+o};Object.defineProperties(he.prototype,ge);const Oe=he(),Te=he({level:ie?ie.level:0});I.Chalk=class{constructor(e){return fe(e)}},I.backgroundColorNames=K,I.backgroundColors=K,I.chalkStderr=Te,I.colorNames=J,I.colors=J;var _e=I.default=Oe;I.foregroundColorNames=H,I.foregroundColors=H,I.modifierNames=W,I.modifiers=W,I.supportsColor=se,I.supportsColorStderr=ie;var $e={error:function(...e){const{logLevel:t}=N();["error","warn","info"].indexOf(t)>-1&&console.log(_e.redBright(...e))},warn:function(...e){const{logLevel:t}=N();["warn","info"].indexOf(t)>-1&&console.log(_e.yellowBright(...e))},info:function(...e){const{logLevel:t}=N();["info"].indexOf(t)>-1&&console.log(_e.blueBright(...e))},success:function(...e){const{logLevel:t}=N();["info"].indexOf(t)>-1&&console.log(_e.greenBright(...e))},log:function(...e){const{logLevel:t}=N();["info"].indexOf(t)>-1&&console.log(...e)},path:function(...e){const{logLevel:t}=N();["info"].indexOf(t)>-1&&console.log(_e.gray(...e))}};const Ce=e=>$e.success(`\n${e}`),Re=()=>{const e=N();return t.resolve(M,e.output)},we=r=>{const n=e.readdirSync(r,{withFileTypes:!0}),o=[];return n.forEach((n=>{if(P.ignores(n.name))return;const s=t.resolve(r,n.name),i=e.statSync(s);i.isDirectory()?o.push(...we(s)):i.isFile()&&n.name.endsWith(".vue")&&($e.path(s),o.push(s))})),o},je={Loading:{use:"Loading.directive",prototype:{loading:"Loading.service"}},MessageBox:{prototype:{msgbox:"MessageBox",alert:"MessageBox.alert",confirm:"MessageBox.confirm",prompt:"MessageBox.prompt"}},Notification:{prototype:{notify:"Notification"}},Message:{prototype:{message:"Message"}}},xe=e=>{const t=je[e];if(!t)return`Vue.use(${e})`;const{use:r,prototype:n}=t,o=[];if(r&&o.push(`Vue.use(${r});`),n){const e=Object.entries(n).map((([e,t])=>`Vue.prototype.$${e} = ${t};`));o.push(...e)}return o.join("\n")},Ee=async()=>{const r=N();Ce("scanning files...");const n=(()=>{const t=Re(),r=new Set;if(e.existsSync(t)){const n=/import\s*{([^}]*)}\s*from\s*['"]([^'"]*)['"]/g,o=e.readFileSync(t,"utf8").matchAll(n);for(const e of o)e[1].split(",").map((e=>e.trim())).forEach((e=>{r.add(e)}))}return r})(),o=we((()=>{const e=N();return t.resolve(M,(e.entry||"").replace(/^\//,""))})()),s=new Set;"element-ui"===r.resolvers&&o.forEach((t=>{const r=(t=>{const r=new Set,n=e.readFileSync(t,"utf-8"),o=n.matchAll(/<(?:el-|El)([^>\s]+)(?=[\s>])/g);for(const e of o){const t=e[1].replace(/^\w/,(e=>e.toUpperCase()));r.add(t)}const s=n.match(/\bv-loading(?::[^=>\s]+)?/g);s?.length&&r.add("Loading");const i=n.matchAll(/\$(?:msgbox|alert|confirm|prompt|notify|message)/g);for(const e of i){const t=e[0].substring(1);"msgbox"===t||"alert"===t||"confirm"===t||"prompt"===t?r.add("MessageBox"):"notify"===t?r.add("Notification"):"message"===t&&r.add("Message")}return r})(t);for(const e of r)s.add(e)}));let i=s.size!==n.size;if(!i)for(const e of s)if(!n.has(e)){i=!0;break}i?await Ae(s):Ce("no update required")},Ae=async o=>{const s=N();Ce(`generating ${s.output}...`);const i=Re();let l="";"element-ui"===s.resolvers&&(l=(e=>`\n    import { ${Array.from(e).join()} } from "element-ui"\n    import Vue from "vue"\n    \n    // 全局按需导入的组件列表\n    ${Array.from(e).map(xe).join("\n")}\n  `)(o));try{if(Ce(`formatting ${s.output}...`),l=n.format(l,{parser:"babel"}),s.check){Ce(`checking ${s.output}...`);const e=new r.ESLint({fix:!0}),[t]=await e.lintText(l);t.output&&(l=t.output)}}catch(e){$e.error(e.stack??e)}if(e.existsSync(i))e.unlinkSync(i);else{const r=t.dirname(i);r!==M&&e.mkdirSync(r,{recursive:!0})}e.writeFileSync(i,l),Ce(`${s.output} genarated!`)};class Me{#e;constructor(e){this.#e=Object.assign({},S,e)}async apply(r){await(async r=>{B=Object.assign({},B,r);const n=t.resolve(M,B.ignorePath);if(e.existsSync(n)){const t=e.readFileSync(n).toString().replace(/\/$/gm,"");P.add(t)}})(this.#e),r.hooks.beforeCompile.tapAsync(Me.name,((e,t)=>{Ee().then((()=>{t()})).catch((e=>{t(e)}))}))}}module.exports=Me;
